<!DOCTYPE html>
<html lang="it">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width,initial-scale=1.0">
        <link rel=stylesheet href="bootstrap/css/bootstrap.css">
        <link rel=stylesheet href="specifiche.css" type="text/css">
        <link rel=stylesheet href="signin.css">
        <link rel=stylesheet href="./js/functions.js">
        
        <title>Accesso</title>
    </head>
    <body class="text-center">
        
        <div class="grid-container-accesso">
            <div class="box-header"> 
                <h2> Descrizione </h2>
            </div>
            <div class="box"><table width="100%">
                <tr>
                    <td>
                        <h2> Accesso </h2>
                        <!--form action="" method="post" id="Bee" onsubmit="Accedi();"-->
                            <input type="email" class="form-control;text-center; border-1 rounded" name="email" id='emailacc' placeholder="Inserire email" style="width: 40%; text-align: center; " required autofocus>
                            <div class="mb-1"></div>
                            <input type="password" class="form-control;text-center; border-1 rounded" id="pacc" placeholder="Inserire password"  style="width: 40%;text-align: center;" required>
                            <div class="mb-2"></div>
                            <button type="submit" id="login" class="btn btn-light" name="submit"  style="font-size: small;"> Accedi </button>

                        <!--/form-->
                    </td>
                </tr>
            </table></div>
            <div class="box">
                <table width="100%">
                    <tr>
                        <td>
                            <h2> Registrazione </h2>
                                <h3>Nome</h3>
                                <input type="text" class="border-1 rounded" id="nreg" required style="width: 40%;text-align: center; "> 
                                <div class="mb-1"></div>
                                <h3>Cognome</h3>
                                <input type="text" class="border-1 rounded" id="creg" required style="width: 40%;text-align: center;"> 
                                <div class="mb-1"></div>
                                <h3>Numero di telefono</h3>
                                <input type="number" class="border-1 rounded" value="Numero di telefono" id="numreg" style="width: 40%;text-align: center;"> 
                                <div class="mb-1"></div>
                                <h3>Email</h3>
                                <input type="email" class="form-control; border-1 rounded" name="email" id="ereg" style="width: 40%; text-align: center;" required >
                                <div class="mb-1"></div>
                                <h3>Password</h3>
                                <input type="password" class="form-control;text-center; border-1 rounded" name="password" id="preg" style="width: 40%;text-align: center;" required>
                                <div class="mb-1"></div>
                                <button type="submit" class="btn btn-light" id="sub"  style="font-size:small;"> Registrati </button>
                        </td>
                    </tr>
                </table>
            </div>
        </div>

        <script type="module">
            // Import the functions you need from the SDKs you need
            import { initializeApp } from "https://www.gstatic.com/firebasejs/9.4.0/firebase-app.js";
            import { getDatabase, set, ref, update } from "https://www.gstatic.com/firebasejs/9.4.0/firebase-database.js";
            import { getAuth, signOut, createUserWithEmailAndPassword, signInWithEmailAndPassword,onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.4.0/firebase-auth.js";
            const firebaseConfig = {
              apiKey: "AIzaSyA0PdI6RRM_VqyxEsUYuPe0Gu_TUrbbuuQ",
              authDomain: "beeteam-2a5f7.firebaseapp.com",
              databaseURL: "https://beeteam-2a5f7-default-rtdb.firebaseio.com",
              projectId: "beeteam-2a5f7",
              storageBucket: "beeteam-2a5f7.appspot.com",
              messagingSenderId: "223479016271",
              appId: "1:223479016271:web:383e9319470cfaf4bd733a",
              measurementId: "G-04ERX78GQJ"
            };
          
            // Initialize Firebase
           const app= initializeApp(firebaseConfig);
           const database = getDatabase(app);
           const auth=getAuth();

           
           sub.addEventListener('click',(e) =>{

            var nome=document.getElementById("nreg").value;
            var cognome=document.getElementById("creg").value;
            var numero=document.getElementById("numreg").value;
            var email=document.getElementById("ereg").value;
            var password=document.getElementById("preg").value;

            createUserWithEmailAndPassword(auth, email, password,nome,cognome,numero)
            .then((userCredential) => {
                 
                 const user = userCredential.user;
                 set(ref(database,'users/' + user.uid),{
                     email : email,
                     password : password
                 });
                 alert("user create");
   
  })
            .catch((error) => {
                 const errorCode = error.code;
                 const errorMessage = error.message;
                 alert(errorMessage);
           });
           });

           login.addEventListener('click', (e) => {

            var email=document.getElementById("emailacc").value;
            var password=document.getElementById("pacc").value;

             signInWithEmailAndPassword(auth, email, password)
             .then((userCredential) => {
   
             const user = userCredential.user;
             const dt= new Date();
             update(ref(database,'users/' + user.uid),{
                     last_login : dt,
                 })
                 alert("User Loged in!");
                 openProfile(user.nome,user.cognome,user.email);
    // ...
           })
           .catch((error) => {
          const errorCode = error.code;
          const errorMessage = error.message;
          alert(errorMessage);
           });

           });

           onAuthStateChanged(auth, (user) => {
           if (user) {
    // User is signed in, see docs for a list of available properties
    // https://firebase.google.com/docs/reference/js/firebase.User
           const uid = user.uid;
          } else {
    // User is signed out
    // ...
        sessionStorage.clear('user');
         }
      });
     
      //CAPIRE DOVE METTERE 
       
           signOut(auth).then(() => {
              // Sign-out successful.
              alert("User Loged out!")
           }).catch((error) => {
             // An error happened.
             const errorCode = error.code;
             const errorMessage = error.message;
          alert(errorMessage);
           });
        
          </script>
          <script src="https://cdnjs.cloudflare.com/ajax/libs/firebase/7.14.1-0/firebase.js"></script>
          <script src="./js/functions.js"></script>
    </body>
</html>